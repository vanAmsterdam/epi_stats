<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Wouter van Amsterdam" />

<meta name="date" content="2018-02-03" />

<title>Positioning as traingles with equal sides</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">epi_stats</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jdblischak/workflowr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Positioning as traingles with equal sides</h1>
<h4 class="author"><em>Wouter van Amsterdam</em></h4>
<h4 class="date"><em>2018-02-03</em></h4>

</div>


<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
<!-- Update knitr chunk options -->
<!-- Insert the date the file was last updated -->
<p><strong>Last updated:</strong> 2018-02-07</p>
<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
<p><strong>Code version:</strong> 8122e6c</p>
<!-- Add your analysis here -->
<div id="setup" class="section level1">
<h1>Setup</h1>
<div id="game-definition" class="section level2">
<h2>Game definition</h2>
<p>Consider the following challenge: a group of 50 people stands in a circle, each one is told to secretly pick two other persons (‘marks’). The objective for everyone is to move to such a position that they form a triangle with equal sides with respect to their two marks.</p>
<p>To add some details, say they are standing in a room with dimensions 20 by 20 meters. For starters, we will assume that people’s positions may coincide. If this is not the case, it is immediately clear that there does not always exist a solution: if 3 persons happen to choose the same 2 marks, since when 2 marks are chosen, exactly 2 points exist that form a traingle of equal sides with them (given that they the 2 marks don’t happen to stand on the same position). However, the chance of this happening is very small, the probability for 2 out of <span class="math inline">\(n\)</span> people to have chosen the same two marks is <span class="math inline">\((n-1) * \frac{1}{n\choose{2}}\)</span>, the chance for 3 persons to have chosen the same 2 marks is even lower. Assume that the stride length is the same for everyone: 0.5 meters per step. People pick their marks randomly (you could pick other strategies, but this adds some nice randomness to the process)</p>
</div>
<div id="r-equivalent" class="section level2">
<h2>R equivalent</h2>
<p>Let’s put in in a picture</p>
<p>Initialize parameters, and load needed R-packages</p>
<pre class="r"><code>library(data.table)
library(ggplot2)
library(magrittr)

npeople = 8
room_dims = c(20,20)
stride = 0.5
pspace = 0.3</code></pre>
<p>Initialize circle</p>
<pre class="r"><code>r0 = 3 # radius of initial circle

df &lt;- data.table(
  id = 1:npeople
)

df[, c(&quot;x0&quot;, &quot;y0&quot;):=
     list(r0 * cos(2*pi*(id-1)/npeople),
          r0 * sin(2*pi*(id-1)/npeople))]

df[, id:=as.factor(id)]

circle0 &lt;- df %&gt;%
  ggplot(aes(x = x0, y = y0, col = id)) + 
  geom_point() + 
  lims(x = c(-1,1)*room_dims[1]/2, y = c(-1,1)*room_dims[2]/2) +
  coord_fixed() + 
  theme_minimal() +
  theme(legend.position = &quot;none&quot;)

circle0_labeled &lt;- 
  circle0 + 
  geom_label(aes(label = id))

circle0_labeled</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Let’s pick random marks for each individual (excluding themselves)</p>
<p>**NB improve code with ‘by = “id”’</p>
<pre class="r"><code>set.seed(1234)

df[, c(&quot;mark_a&quot;, &quot;mark_b&quot;):=data.frame(t(apply(.SD, 1, function(row) 
  sample(setdiff(factor(1:npeople), row[[&quot;id&quot;]]), size = 2, replace = F))))]

setkey(df, id)

df[1:10, list(id, mark_a, mark_b)]</code></pre>
<pre><code>    id mark_a mark_b
 1:  1      2      5
 2:  2      6      5
 3:  3      8      5
 4:  4      1      2
 5:  5      6      4
 6:  6      5      4
 7:  7      2      6
 8:  8      3      6
 9: NA     NA     NA
10: NA     NA     NA</code></pre>
<p>Visualize a few subject and mark pairs</p>
<pre class="r"><code>df[, c(&quot;ma_x0&quot;, &quot;ma_y0&quot;):=.SD[as.character(mark_a), list(x0, y0)]]
df[, c(&quot;mb_x0&quot;, &quot;mb_y0&quot;):=.SD[as.character(mark_b), list(x0, y0)]]</code></pre>
<pre class="r"><code>circle0 +
  geom_segment(data = df[c(1)], 
               aes(x = x0, xend = ma_x0, y = y0, yend = ma_y0), 
               linetype = 2) + 
  geom_segment(data = df[c(1)], 
               aes(x = x0, xend = mb_x0, y = y0, yend = mb_y0),
               linetype = 2)</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="model-behaviour" class="section level1">
<h1>Model behaviour</h1>
<p>Now let’s see if we can converge to a solution where everyone get’s to a position in which they are in a equal side triangle with their two targets.</p>
<div id="solution-1-single-step-towards-goal" class="section level2">
<h2>Solution 1: single step towards goal</h2>
<p>Say everyone has a keen eye for where they should stand, given that their targets stand at points <span class="math inline">\(x_{target_1},y_{target_1}\)</span> and <span class="math inline">\(x_{target_2}, y_{target_2}\)</span>. With some math, we can see that the subject should move to one of 2 positions.</p>
<p>The target point for each subject lies on the circle with as center one of the marks (let’s take mark ‘a’ for simplicity), with a radius of the distance between mark a and mark b, and at a position of 60 degrees more or less than the angle between mark a and b.</p>
<p>Some restritions apply to this target point:</p>
<ul>
<li>it must be within the room</li>
<li>when there are two options, choose the one that’s nearest by</li>
</ul>
<div id="set-target-position" class="section level3">
<h3>Set target position</h3>
<p>Let’s create a function to determine the target point for a subject (this took a piece of paper and some fiddling with the trigonometric functions)</p>
<pre class="r"><code>get_target.single &lt;- function(x0, y0, ma_x0, ma_y0, mb_x0, mb_y0,
                              if_none = &quot;original&quot;) {
  
  p0  = c(x0, y0)
  ma = c(ma_x0, ma_y0)
  mb = c(mb_x0, mb_y0)
  m_center = (ma + mb) / 2
  
  # calculate distance between mark a and b, and the angles between them
  theta_a  = atan2(ma_y0, ma_x0)
  theta_b  = atan2(mb_y0, mb_x0)
  theta_ab = theta_b - theta_a

  d_ab     = sqrt(sum((mb - ma) ^ 2))
  
  # target points are determined by taking a step from the middle between 
  # the marks
  stride   = (.5*d_ab) / tan(.5 * (1/6) * 2 * pi)

  # calculate candidate target points
  tx1 = m_center[1] + stride * cos(theta_a + theta_ab / 2)
  ty1 = m_center[2] + stride * sin(theta_a + theta_ab / 2)
  tx2 = m_center[1] - stride * cos(theta_a + theta_ab / 2)
  ty2 = m_center[2] - stride * sin(theta_a + theta_ab / 2)
  # ty1 = ma_y0 + radius * sin(angle_ab + 2*pi*60/360)
  # tx2 = ma_x0 + radius * cos(angle_ab - 2*pi*60/360)
  # ty2 = ma_y0 + radius * sin(angle_ab - 2*pi*60/360)

  # check if both target points are within the room
  t1_ok = abs(tx1) &lt; room_dims[1] / 2 &amp; abs(ty1) &lt; room_dims[2] / 2
  t2_ok = abs(tx2) &lt; room_dims[1] / 2 &amp; abs(ty2) &lt; room_dims[2] / 2
  
  # if 1 of both is ok, take that point
  if (sum(c(t1_ok, t2_ok)) == 1) {
    if (t1_ok) return(c(tx1, ty1))
    return(c(tx2, tx2))
  } 
  
  # if none are ok, return NA&#39;s or the original position
  if (sum(c(t1_ok, t2_ok)) == 0) {
    if (if_none == &quot;original&quot;) return(c(x0,y0))
    return(c(NA,NA))
  }
  
  # if both are ok, take the one that&#39;s closest by, or the first one
  d1 = sqrt(sum((c(tx1, ty1) - p0) ^ 2))
  d2 = sqrt(sum((c(tx2, ty2) - p0) ^ 2))
  
  if (d1 &lt;= d2) {
    return(c(tx1, ty1))
  }
  return(c(tx2, ty2))
}

get_target &lt;- function(x0, y0, ma_x0, ma_y0, mb_x0, mb_y0) {
  df &lt;- cbind(x0, y0, ma_x0, ma_y0, mb_x0, mb_y0)
  targets &lt;- apply(df, 1, function(x) {
    get_target.single(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]])
  })
  data.frame(t(targets))
}
  
df[, c(&quot;tx0&quot;, &quot;ty0&quot;):=get_target(x0, y0, ma_x0, ma_y0, mb_x0, mb_y0)]</code></pre>
<p>Check correctness of solutions</p>
<pre class="r"><code>df[, t_correct:={
  da  = norm(matrix(c(tx0 - ma_x0, ty0 - ma_y0)), type = &quot;F&quot;)
  db  = norm(matrix(c(tx0 - mb_x0, ty0 - mb_y0)), type = &quot;F&quot;)
  dab = norm(matrix(c(mb_x0 - ma_x0, mb_y0 - ma_y0)), type = &quot;F&quot;)
  max(dist(c(da, db, dab)) &lt; 0.001)
}, by = &quot;id&quot;]</code></pre>
<p>Visualize target positions for a few subjects</p>
<pre class="r"><code>samples = sample(1:npeople, size = 2)
circle0 + 
  geom_segment(data = df[samples], 
               aes(x = tx0, xend = ma_x0, y = ty0, yend = ma_y0)) +
  geom_segment(data = df[samples], 
               aes(x = tx0, xend = mb_x0, y = ty0, yend = mb_y0)) +
  geom_segment(data = df[samples], 
               aes(x = ma_x0, xend = mb_x0, y = ma_y0, yend = mb_y0)) +
  geom_segment(data = df[samples], 
               aes(x = x0, xend = tx0, y = y0, yend = ty0),
               arrow = arrow(), linetype = 2, alpha = .5)</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="take-step-to-target-position" class="section level3">
<h3>Take step to target position</h3>
<p>Create a function to define a step to the target position</p>
<pre class="r"><code>take_step.single &lt;- function(x, y, tx, ty, stride = .5) {
  direction &lt;- c(tx, ty) - c(x, y)
  direction_normalized &lt;- direction / sqrt(sum(direction^2))
  next_step = stride * direction_normalized
  new_position = c(x, y) + next_step
}
take_step &lt;- function(x, y, tx, ty, stride = .5) {
  data = cbind(x, y, tx, ty)
  as.data.frame(t(apply(data, 1, function(row) 
    take_step.single(row[1], row[2], row[3], row[4], stride = stride))))
}</code></pre>
<p>To track the positions for each participants, let’s create a new data structure.</p>
<pre class="r"><code># library(tibbletime)
# nsteps = 100
# 
# positions &lt;- create_series(&#39;00:00:00&#39; ~ &#39;00:05:00&#39;, &#39;second&#39;, class = &quot;hms&quot;)</code></pre>
<pre class="r"><code>nsteps = 100
stride = 0.5
positions &lt;- array(dim = c(nsteps+1, npeople, 2), 
                   dimnames = list(paste0(&quot;step-&quot;,0:nsteps),
                                   paste0(&quot;id-&quot;, 1:npeople), 
                                   c(&quot;x&quot;, &quot;y&quot;)))

positions[1,,1] &lt;- df$x0
positions[1,,2] &lt;- df$y0

## Set initial positions
df[, c(&quot;x&quot;, &quot;y&quot;):=list(x0, y0)]

for (i in 1:nsteps) {
  df[, c(&quot;ma_x&quot;, &quot;ma_y&quot;):= .SD[as.character(mark_a), list(x, y)]]
  df[, c(&quot;mb_x&quot;, &quot;mb_y&quot;):= .SD[as.character(mark_b), list(x, y)]]
  df[, c(&quot;tx&quot;, &quot;ty&quot;)    := get_target(x, y, ma_x, ma_y, mb_x, mb_y)]
  df[, c(&quot;x&quot;, &quot;y&quot;)      := take_step(x, y, tx, ty, stride = stride)]
  positions[i+1,,1] = df$x
  positions[i+1,,2] = df$y
}</code></pre>
<p>Plot x-coordinate of a subject, to see if this process converges</p>
<pre class="r"><code>plot(positions[,1,1])</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Let’s try decreasing the step size after some time</p>
<pre class="r"><code>nsteps = 100
stride = 0.5
strides= ((nsteps - 1:nsteps) / nsteps) * stride
positions &lt;- array(dim = c(nsteps+1, npeople, 2), 
                   dimnames = list(paste0(&quot;step-&quot;,0:nsteps),
                                   paste0(&quot;id-&quot;, 1:npeople), 
                                   c(&quot;x&quot;, &quot;y&quot;)))

positions[1,,1] &lt;- df$x0
positions[1,,2] &lt;- df$y0

## Set initial positions
df[, c(&quot;x&quot;, &quot;y&quot;):=list(x0, y0)]

for (i in 1:nsteps) {
  stride = strides[i]
  df[, c(&quot;ma_x&quot;, &quot;ma_y&quot;):= .SD[as.character(mark_a), list(x, y)]]
  df[, c(&quot;mb_x&quot;, &quot;mb_y&quot;):= .SD[as.character(mark_b), list(x, y)]]
  df[, c(&quot;tx&quot;, &quot;ty&quot;)    := get_target(x, y, ma_x, ma_y, mb_x, mb_y)]
  df[, c(&quot;x&quot;, &quot;y&quot;)      := take_step(x, y, tx, ty, stride = stride)]
  positions[i+1,,1] = df$x
  positions[i+1,,2] = df$y
}</code></pre>
<p>Plot x-coordinate of a subject, to see if this process converges, but now weighted for the stride size</p>
<pre class="r"><code>plot(positions[,1,1] / c(1,strides))</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="define-how-good-a-solution-is" class="section level2">
<h2>Define how good a solution is</h2>
<p>We can say that for each person, the cost is the sum of the differences between the distance between their marks and the distance of the subject to each mark.</p>
<p><span class="math display">\[cost = |d_{subject, mark_a} - d_{mark_a, mark_b}| + |d_{subject, mark_b} - d_{mark_a, mark_b}|\]</span></p>
<pre class="r"><code>cost_function &lt;- function(x, y, ma_x, ma_y, mb_x, mb_y) {
  d_ab &lt;- sqrt(sum((ma_x - mb_x)^2, (ma_y - mb_y)^2))
  d_a &lt;- sqrt(sum((x - ma_x)^2, (y - ma_y)^2))
  d_b &lt;- sqrt(sum((x - mb_x)^2, (y - mb_y)^2))
  abs(d_a - d_ab) + abs(d_b - d_ab)
}</code></pre>
<p>Re run the simulation, keeping track of the cost (for each subject)</p>
<pre class="r"><code>nsteps = 100
stride = 0.5
strides= ((nsteps - 1:nsteps) / nsteps) * stride
positions &lt;- array(dim = c(nsteps+1, npeople, 2), 
                   dimnames = list(paste0(&quot;step-&quot;,0:nsteps),
                                   paste0(&quot;id-&quot;, 1:npeople), 
                                   c(&quot;x&quot;, &quot;y&quot;)))
costs &lt;- array(dim = c(nsteps+1, npeople, 1))

positions[1,,1] &lt;- df$x0
positions[1,,2] &lt;- df$y0
costs[1,,1] &lt;- df[, list(cost = cost_function(x0, y0, ma_x0, ma_y0, mb_x0, ma_y0)), by = &quot;id&quot;]$cost

## Set initial positions
df[, c(&quot;x&quot;, &quot;y&quot;):=list(x0, y0)]

for (i in 1:nsteps) {
  stride = strides[i]
  df[, c(&quot;ma_x&quot;, &quot;ma_y&quot;):= .SD[as.character(mark_a), list(x, y)]]
  df[, c(&quot;mb_x&quot;, &quot;mb_y&quot;):= .SD[as.character(mark_b), list(x, y)]]
  df[, c(&quot;tx&quot;, &quot;ty&quot;)    := get_target(x, y, ma_x, ma_y, mb_x, mb_y)]
  df[, c(&quot;x&quot;, &quot;y&quot;)      := take_step(x, y, tx, ty, stride = stride)]
  positions[i+1,,1] = df$x
  positions[i+1,,2] = df$y
  costs[i+1,,1] &lt;- df[, list(cost = cost_function(x, y, ma_x, ma_y, mb_x, ma_y)), by = &quot;id&quot;]$cost
}</code></pre>
<p>Gather costs in a convenient data.table format, and plot the costs per subject over time</p>
<pre class="r"><code>cost_df &lt;- as.data.table(costs)
cost_df[, id:=factor(rep(1:npeople, each = nsteps + 1))]
cost_df[, step:=rep(0:nsteps, times = npeople)]

cost_df %&gt;%
  ggplot(aes(x = step, y = costs, col = id)) + 
  geom_line()</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As we see, the cost decreases, but it never saturates.</p>
<p>Let’s now gather all the positions in a table, see if we can visualize this nicely</p>
<pre class="r"><code>position_df &lt;- as.data.table(positions)
position_df[, step:=rep(0:nsteps, times = npeople * 2)]
position_df[, coordinate:=rep(c(&quot;x&quot;, &quot;y&quot;), each = (nsteps + 1) * npeople)]
position_df[, id:=factor(rep(1:npeople, each = nsteps + 1, times = 2))]
position_df &lt;- dcast.data.table(position_df, step + id ~ coordinate, value.var = &quot;positions&quot;)</code></pre>
<p>Animate using <code>gganimate</code> (available on github)</p>
<pre class="r"><code>library(gganimate)
p &lt;- position_df %&gt;%
  ggplot(aes(x = x, y = y, col = id, frame = step)) + 
  geom_point() + 
  lims(x = c(-1,1)*room_dims[1]/2, y = c(-1,1)*room_dims[2]/2) +
  coord_fixed() + 
  theme_minimal() +
  theme(legend.position = &quot;none&quot;)

gganimate(p)</code></pre>
<p><img src="figure/circle_dance.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-2.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-3.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-4.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-5.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-6.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-7.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-8.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-9.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-10.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-11.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-12.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-13.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-14.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-15.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-16.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-17.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-18.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-19.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-20.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-21.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-22.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-23.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-24.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-25.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-26.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-27.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-28.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-29.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-30.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-31.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-32.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-33.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-34.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-35.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-36.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-37.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-38.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-39.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-40.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-41.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-42.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-43.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-44.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-45.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-46.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-47.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-48.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-49.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-50.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-51.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-52.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-53.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-54.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-55.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-56.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-57.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-58.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-59.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-60.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-61.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-62.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-63.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-64.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-65.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-66.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-67.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-68.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-69.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-70.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-71.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-72.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-73.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-74.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-75.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-76.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-77.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-78.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-79.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-80.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-81.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-82.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-83.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-84.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-85.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-86.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-87.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-88.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-89.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-90.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-91.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-92.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-93.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-94.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-95.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-96.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-97.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-98.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-99.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-100.png" width="672" style="display: block; margin: auto;" /><img src="figure/circle_dance.Rmd/unnamed-chunk-19-101.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="session-information" class="section level2">
<h2>Session information</h2>
<!-- Insert the session information into the document -->
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 3.4.3 (2017-11-30)
Platform: x86_64-apple-darwin15.6.0 (64-bit)
Running under: macOS Sierra 10.12.6

Matrix products: default
BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] gganimate_0.1.0.9000 magrittr_1.5         ggplot2_2.2.1       
[4] data.table_1.10.4-3 

loaded via a namespace (and not attached):
 [1] Rcpp_0.12.14     knitr_1.18       munsell_0.4.3    colorspace_1.3-2
 [5] rlang_0.1.6      stringr_1.2.0    plyr_1.8.4       tools_3.4.3     
 [9] grid_3.4.3       gtable_0.2.0     git2r_0.20.0     htmltools_0.3.6 
[13] yaml_2.1.16      lazyeval_0.2.1   rprojroot_1.2    digest_0.6.14   
[17] tibble_1.4.1     evaluate_0.10.1  rmarkdown_1.8    labeling_0.3    
[21] stringi_1.1.6    compiler_3.4.3   pillar_1.1.0     scales_0.5.0    
[25] backports_1.1.2 </code></pre>
</div>
</div>

<hr>
<p>
    This <a href="http://rmarkdown.rstudio.com">R Markdown</a> site was created with <a href="https://github.com/jdblischak/workflowr">workflowr</a>
</p>
<hr>

<!-- To enable disqus, uncomment the section below and provide your disqus_shortname -->

<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
